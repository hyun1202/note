# 아키텍처
- 시스템의 기본적인 구조를 정의
- 시스템의 중요한 품질 속성에 큰 영향을 미친다.
- 설계 결정의 기반이 되는 핵심적인 개념
- 기본 구성 요소와 상호 관계, 제약 조건, 원칙 등을 포함

## 계층형 아키텍처(Layered Architecture)
- 서브 시스템을 계층으로 구조화하는 아키텍처 스타일
- 계층은 사용 관계로 연결
- 사용 관계는 일반적으로 **단방향**이어야 한다
	- 상위 계층이 하위 계층의 서비스를 사용하는 **하향식 흐름**
- 각 계층이 하위 계층의 내부 작동 방식을 알지 못한다. -> 제한된 인터페이스만 사용
	- 어떤 레이어의 변경이 다른 레이어의 컴포넌트에게 가능한 영향을 주지 않도록 해야한다.

### 3계층 아키텍처
```
요청 -> Presentation(UI) -> Business Logic(Domain, Transaction Script) -> Infra(Persistence, Data)
```

Domain Model Pattern?? -> 4 계층 아키텍처

```
요청 -> Presentation(UI) -> Application Service -> Domain -> Infra
```

- Business Logic을 세분화 하여 Application Service, Domain 계층을 나눈다.

### 헥사고날 아키텍처
- 2005년 앨리스터 코번이 제안한 아키텍처
- 계층형 아키텍처의 단방형 비대칭 구조가 아닌 **대칭형 아키텍처**
	- 위 아래, 좌 우가 아닌 **애플리케이션의 내부와 외부 세계라는 대칭 구조**를 가진다.
- 아키텍처의 대칭성을 가진 구조를 그리기 쉬운 대표적인 도형인 육각형(hexagonal)으로 설명
	- 6개의 면을 가진게 특별한 의미가 아님.
#### 헥사곤의 내부
- 쉽게 변하지 않는, 중요한 도메인 로직을 담은 코어 애플리케이션
	- 도메인 로직을 가진 트랜잭션 스크립트
	- 애플리케이션 서비스와 도메인 모델 패턴을 따라서 만든 도메인
- `Actor`: 헥사곤과 작용하는 모든 것 
	- 사용자, 브라우저, CLI 명령, 기계 다른 시스템
	- 운영 환경, DB, 메시징 시스템, 메일 시스템
	- 테스트 등
**헥사고날 아키텍처의 특징과 혜택**
- 테스팅!!! 
	- 운영 시스템에 연결되지 않고 애플리케이션 테스트
- 애플리케이션과 상호작용하는 액터가 변경되더라도 다시 빌드하지 않고 테스트할 수 있다.
- UI 디테일이나 기술 정보가 도메인 로직 안으로 노출되지 않도록 보호
- 컴포넌트를 각각 개발하고 연결하는 방식으로 **큰 시스템을 분리**할 수 있다.
- 시간이 지나면서 외부 연결을 다른 것으로 변경할 수 있다.
- 기술 요소를 제거했기 때문에 **도메인 설계에 집중할 수 있다.**

## 포트 (port)
- 애플리케이션이 외부 세계와 의도를 가지고 상호작용하는 아이디어를 캡처한 것
- 단순히 데이터를 주고받는 것이 아니라, 명확한 목적과 방향을 가지고 외부와 연결
- ex) 회원 등록, 회원 정보 저장, 강의 수강 신청, 이메일 발송

## 인터페이스
- Lollipop: Provided Interface - 기능 제공 인터페이스
- Socket: Required Interface - 기능 요구 인터페이스

## 어뎁터 (adapter)
- 애플리케이션의 포트를 **액터가 직접 연결할 수 없다면** 인터페이스 변환을 위한 어댑터를 도입

> 포트와 어댑터 아키텍처
> - 헥사고날 아키텍처의 특징을 담은 새로운 이름

## 오해
1. 애플리케이션 내부에 도메인 계층을 만들어야 한다.
	- 애플리케이션 내부 구현에 대한 원칙이나 요구사항이 없다.
	- 도메인 계층을 포함하는 아키텍처는 클린 아키텍처이다.
2. 헥사고날 아키텍처 패키지 구조를 따라야 한다.
	- 헥사고날 아키텍처가 요구하는 패키지 구조는 없다.
	- 애플리케이션과 어댑터 패키지를 분리하는 것은 바람직
	- 포트를 구분된 패키지에 두는 것을 권장한다.
3. 포트는 UseCase라는 접미사를 사용한다
	- 포트의 의도를 담은 이름을 사용하면 된다.
	- for + ~ing 스타일의 권장 네이밍은 있지만 이를 따를 필요는 없다.
4. 애플리케이션에는 도메인 모델만 넣고 JPA 엔티티 등은 어댑터에 둬야 한다.
	- 애플리케이션 코드와 포트 인터페이스가 외부 기술에 의존하지 않으면 된다..

## 사실
- 애플리케이션은 모든 외부와의 상호작용을 위해 **Provided Interface와 Required Interface를 정의**한다.
- 애플리케이션과 상호작용하는 **액터는 런타임에 구성**되어야 한다.
- 애플리케이션은 **액터에 대한 코드 의존성을 가지면 안된다.**
- 액터는 정의된 포트를 통해서만 연결해야 한다.
- 포트의 인터페이스에는 **기술 의존성을 가지지 않는다.**

## 엔티티 식별자
- 고유성: 두 개의 엔티티가 같은 값을 가지면 안 된다
- 불변성: 한 번 값이 할당되면 엔티티의 생명주기 동안 **절대 변경되면 안 된다.**
	- 참조 정합성을 훼손하고, 연관관계를 깨뜨린다.
- 비즈니스적인 의미로부터 디커플링 되는 것이 낫다
	- 자연 키 대신 인조 키(대리 키) 사용